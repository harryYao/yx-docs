<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、异步编程简介 | 前端小记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/yx-docs/favicon.ico">
    <meta name="description" content="yaoxin的笔记文档">
    
    <link rel="preload" href="/yx-docs/assets/css/0.styles.9a4ca8c0.css" as="style"><link rel="preload" href="/yx-docs/assets/js/app.2a3687b5.js" as="script"><link rel="preload" href="/yx-docs/assets/js/2.0d19cfa1.js" as="script"><link rel="preload" href="/yx-docs/assets/js/18.9ed11dc3.js" as="script"><link rel="prefetch" href="/yx-docs/assets/js/10.c78ff89c.js"><link rel="prefetch" href="/yx-docs/assets/js/11.c0f7588c.js"><link rel="prefetch" href="/yx-docs/assets/js/12.94652994.js"><link rel="prefetch" href="/yx-docs/assets/js/13.309d4e50.js"><link rel="prefetch" href="/yx-docs/assets/js/14.42c618ac.js"><link rel="prefetch" href="/yx-docs/assets/js/15.69b892d9.js"><link rel="prefetch" href="/yx-docs/assets/js/16.24d58bc2.js"><link rel="prefetch" href="/yx-docs/assets/js/17.97f8b872.js"><link rel="prefetch" href="/yx-docs/assets/js/19.e113c0f2.js"><link rel="prefetch" href="/yx-docs/assets/js/20.b52c4403.js"><link rel="prefetch" href="/yx-docs/assets/js/21.ff174f99.js"><link rel="prefetch" href="/yx-docs/assets/js/22.37206b8a.js"><link rel="prefetch" href="/yx-docs/assets/js/23.3dea98cc.js"><link rel="prefetch" href="/yx-docs/assets/js/24.991e4352.js"><link rel="prefetch" href="/yx-docs/assets/js/3.0bf74bf5.js"><link rel="prefetch" href="/yx-docs/assets/js/4.04feb3f1.js"><link rel="prefetch" href="/yx-docs/assets/js/5.f27f6877.js"><link rel="prefetch" href="/yx-docs/assets/js/6.f8bc49fe.js"><link rel="prefetch" href="/yx-docs/assets/js/7.92386821.js"><link rel="prefetch" href="/yx-docs/assets/js/8.66b4bf0d.js"><link rel="prefetch" href="/yx-docs/assets/js/9.446182e1.js">
    <link rel="stylesheet" href="/yx-docs/assets/css/0.styles.9a4ca8c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yx-docs/" class="home-link router-link-active"><img src="/yx-docs/logo.png" alt="前端小记" class="logo"> <span class="site-name can-hide">前端小记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/harryYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/harryYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/js基础/01_js类型.html" class="sidebar-link">js基础类型</a></li><li><a href="/yx-docs/js基础/02_dom操作.html" class="sidebar-link">DOM操作</a></li><li><a href="/yx-docs/js基础/03_原型原型链.html" class="sidebar-link">原型 prototype</a></li><li><a href="/yx-docs/js基础/04_作用域作用域链.html" class="sidebar-link">作用域</a></li><li><a href="/yx-docs/js基础/05_闭包.html" class="sidebar-link">闭包 closure</a></li><li><a href="/yx-docs/js基础/06_继承.html" class="sidebar-link">继承</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/css基础/01_选择器.html" class="sidebar-link">css选择器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>博客文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/articles/window.name.html" class="sidebar-link">window.name</a></li><li><a href="/yx-docs/questions/跨域.html" class="sidebar-link">何为跨域？</a></li><li><a href="/yx-docs/questions/http协议.html" class="sidebar-link">HTTP协议</a></li><li><a href="/yx-docs/questions/https介绍.html" class="sidebar-link">HTTPS介绍</a></li><li><a href="/yx-docs/questions/JS异步编程.html" class="active sidebar-link">一、异步编程简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yx-docs/questions/JS异步编程.html#一、异步编程简介" class="sidebar-link">一、异步编程简介</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/JS异步编程.html#二、异步编程的发展" class="sidebar-link">二、异步编程的发展</a></li></ul></li><li><a href="/yx-docs/questions/Event Loop是什么.html" class="sidebar-link">JS是单线程的</a></li><li><a href="/yx-docs/questions/输入URL回车后的过程.html" class="sidebar-link">浏览器输入 URL 回车之后发生了什么</a></li><li><a href="/yx-docs/questions/onload.html" class="sidebar-link">window.onload() &amp; document.ready() 事件先后顺序</a></li><li><a href="/yx-docs/vue/vue技巧大全.html" class="sidebar-link">VUE技巧大全</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、异步编程简介"><a href="#一、异步编程简介" class="header-anchor">#</a> 一、异步编程简介</h2> <p>众所周知JavaScript语言执行环境是“单线程”（单线程，就是指一次只能完成一件任务，如果有多个任务就必须排队等候，前面一个任务完成，再执行后面一个任务）。这种“单线程”模式执行效率较低，任务耗时长。<br>
  为了解决这个问题，提出了“异步模式”(异步模式，是指后一个任务不等前一个任务执行完就执行，每个任务有一个或多个回调函数)。<br>
  异步模式使得JavaScript在处理事务时非常高效，但也带来很多问题，如异常处理困难、嵌套过深。</p> <h2 id="二、异步编程的发展"><a href="#二、异步编程的发展" class="header-anchor">#</a> 二、异步编程的发展</h2> <p>JavaScript异步编程从出现不断发展和精进，主要经历了以下4个阶段：</p> <h3 id="阶段1-传统callback回调函数"><a href="#阶段1-传统callback回调函数" class="header-anchor">#</a> 阶段1 传统callback回调函数</h3> <p>回调函数，就是把任务的第二段单独写在一个函数里面，等到重新执行这个任务的时候，就直接调用这个函数。它的英语名字 callback，直译过来就是&quot;重新调用&quot;。虽然回调函数多用于异步编程，但带有回调函数的方法不一定是异步的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// demo1（简单callback封装）</span>
<span class="token keyword">function</span> <span class="token function">successCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'callback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">successCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这里表示执行了一大堆各种代码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 其他代码执行完毕，最后执行回调函数</span>
   successCallback <span class="token keyword">instanceof</span> <span class="token class-name">Function</span> <span class="token operator">&amp;&amp;</span> <span class="token function">successCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//callback hell 回调地狱</span>
<span class="token function">doSomethingAsync1</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">doSomethingAsync2</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">doSomethingAsync3</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">doSomethingAsync4</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">doSomethingAsync5</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// code...</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以发现一个问题，在回调函数嵌套层数不深的情况下，代码还算容易理解和维护，一旦嵌套层数加深，就会出现“回调金字塔”的问题，就像demo2那样，如果这里面的每个回调函数中又包含了很多业务逻辑的话，整个代码块就会变得非常复杂。从逻辑正确性的角度来说，上面这几种回调函数的写法没有任何问题，但是随着业务逻辑的增加和趋于复杂，这种写法的缺点马上就会暴露出来，想要维护它们实在是太痛苦了，这就是“回调地狱(callback hell)”。</p> <h3 id="阶段2-事件发布-订阅模式"><a href="#阶段2-事件发布-订阅模式" class="header-anchor">#</a> 阶段2 事件发布/订阅模式</h3> <p>发布订阅模式，它定义了一种一对多的关系，可以使多个观察者对象对一个主题对象进行事件监听，当这个主题对象发生改变时，依赖的所有对象都会被通知到。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">PubSub</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handlers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">PubSub</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventType<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>eventType <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加事件监听器</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token comment">//返回上下文环境以实现链式调用</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">PubSub</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">publish</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eventType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> _args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> _handlers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _handlers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _handlers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 遍历事件监听器</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PubSub</span><span class="token punctuation">;</span><span class="token comment">// 构造PubSub实例</span>
event<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
event<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'one,'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Object {data: Array[2]}</span>
</code></pre></div><h3 id="阶段3-deferred"><a href="#阶段3-deferred" class="header-anchor">#</a> 阶段3 Deferred</h3> <p>jQuery $.Deferred() 是一个构造函数，用来返回一个链式实用对象方法来注册多个回调，并且调用回调队列，传递任何同步或异步功能成功或失败的状态。成功回调done()中使用deferred.resolve，失败回调fail()中使用deferred.reject。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> deferred <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">Deferred</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
    dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> data
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showError</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>message <span class="token operator">||</span> <span class="token string">&quot;操作发生错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">showError</span><span class="token punctuation">(</span><span class="token string">&quot;服务器错误，请稍后再试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">always</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>button<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        button<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&quot;disabled&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> deferred<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="阶段4-promise"><a href="#阶段4-promise" class="header-anchor">#</a> 阶段4 Promise</h3> <p>Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。<br>
  所谓Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，Promise 是一个对象，从它可以获取异步操作的消息。Promise 提供统一的 API，各种异步操作都可以用同样的方法进行处理。<br>
  使用Promise对象可以用同步操作的流程写法来表达异步操作，避免了层层嵌套的异步回调，代码也更加清晰易懂，方便维护，也可以捕捉异常。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> num <span class="token operator">==</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第1个then：参数是一个number值'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第2个then'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'haha'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 第1个then：参数是一个number值、第2个then</span>
</code></pre></div><h3 id="异步编程解决方案的优缺点"><a href="#异步编程解决方案的优缺点" class="header-anchor">#</a> 异步编程解决方案的优缺点：</h3> <table><thead><tr><th>表头</th> <th>callback回调</th> <th>事件发布/订阅</th> <th>Deferred</th> <th>Promise</th></tr></thead> <tbody><tr><td>优点</td> <td>简单、容易理解</td> <td>容易理解，可以绑定多个事件，每个事件可以指定多个回调函数</td> <td>避免了层层嵌套的回调函数，有统一的API，使得控制异步操作更加容易</td> <td>ES6将promise写进了语言标准，统一了使用的语法，使用简洁方便，比传统异步解决方案更合理强大</td></tr> <tr><td>缺点</td> <td>不利于代码的阅读和维护，会出现“回调地域”，而且每个任务只能指定一个回调函数</td> <td>由事件驱动，运行流程变得很不清晰</td> <td>状态不可逆，确定状态后再次调用resolve/reject对原状态不起任何作用</td> <td>状态不可逆</td></tr></tbody></table> <hr> <p>作者：小铭子   链接：https://juejin.cn/post/6844903889477566471</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yx-docs/questions/https介绍.html" class="prev">
        HTTPS介绍
      </a></span> <span class="next"><a href="/yx-docs/questions/Event Loop是什么.html">
        JS是单线程的
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yx-docs/assets/js/app.2a3687b5.js" defer></script><script src="/yx-docs/assets/js/2.0d19cfa1.js" defer></script><script src="/yx-docs/assets/js/18.9ed11dc3.js" defer></script>
  </body>
</html>
