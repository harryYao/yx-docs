<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EVENT LOOP | 前端小记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="/yx-docs/favicon.ico">
    <meta name="description" content="yaoxin的笔记文档">
    
    <link rel="preload" href="/yx-docs/assets/css/0.styles.f26e5750.css" as="style"><link rel="preload" href="/yx-docs/assets/js/app.5a460998.js" as="script"><link rel="preload" href="/yx-docs/assets/js/2.beed6d36.js" as="script"><link rel="preload" href="/yx-docs/assets/js/38.ba52d01e.js" as="script"><link rel="prefetch" href="/yx-docs/assets/js/10.ef9da421.js"><link rel="prefetch" href="/yx-docs/assets/js/11.9b5392f0.js"><link rel="prefetch" href="/yx-docs/assets/js/12.709b7d3b.js"><link rel="prefetch" href="/yx-docs/assets/js/13.21ee67c2.js"><link rel="prefetch" href="/yx-docs/assets/js/14.3e877896.js"><link rel="prefetch" href="/yx-docs/assets/js/15.38c2c5fd.js"><link rel="prefetch" href="/yx-docs/assets/js/16.fc417a38.js"><link rel="prefetch" href="/yx-docs/assets/js/17.399b3d5f.js"><link rel="prefetch" href="/yx-docs/assets/js/18.e8b9f64e.js"><link rel="prefetch" href="/yx-docs/assets/js/19.bcba6736.js"><link rel="prefetch" href="/yx-docs/assets/js/20.ad22a0aa.js"><link rel="prefetch" href="/yx-docs/assets/js/21.abf37f07.js"><link rel="prefetch" href="/yx-docs/assets/js/22.15816c2d.js"><link rel="prefetch" href="/yx-docs/assets/js/23.3118e001.js"><link rel="prefetch" href="/yx-docs/assets/js/24.262d541f.js"><link rel="prefetch" href="/yx-docs/assets/js/25.d5d5b31f.js"><link rel="prefetch" href="/yx-docs/assets/js/26.f8ad1c03.js"><link rel="prefetch" href="/yx-docs/assets/js/27.563d7bf1.js"><link rel="prefetch" href="/yx-docs/assets/js/28.0d36fbb9.js"><link rel="prefetch" href="/yx-docs/assets/js/29.c181a55e.js"><link rel="prefetch" href="/yx-docs/assets/js/3.3cc5e67c.js"><link rel="prefetch" href="/yx-docs/assets/js/30.b10c9ca6.js"><link rel="prefetch" href="/yx-docs/assets/js/31.88aeca61.js"><link rel="prefetch" href="/yx-docs/assets/js/32.eea9e6c5.js"><link rel="prefetch" href="/yx-docs/assets/js/33.2053affe.js"><link rel="prefetch" href="/yx-docs/assets/js/34.1c109941.js"><link rel="prefetch" href="/yx-docs/assets/js/35.b38f3547.js"><link rel="prefetch" href="/yx-docs/assets/js/36.b65774cc.js"><link rel="prefetch" href="/yx-docs/assets/js/37.f0220103.js"><link rel="prefetch" href="/yx-docs/assets/js/39.4600b9a1.js"><link rel="prefetch" href="/yx-docs/assets/js/4.8fdb6c92.js"><link rel="prefetch" href="/yx-docs/assets/js/40.d5f9b7fe.js"><link rel="prefetch" href="/yx-docs/assets/js/41.654e2c88.js"><link rel="prefetch" href="/yx-docs/assets/js/42.3259130c.js"><link rel="prefetch" href="/yx-docs/assets/js/43.1015a155.js"><link rel="prefetch" href="/yx-docs/assets/js/44.461a5dfe.js"><link rel="prefetch" href="/yx-docs/assets/js/45.eb84978a.js"><link rel="prefetch" href="/yx-docs/assets/js/46.baa40100.js"><link rel="prefetch" href="/yx-docs/assets/js/47.488253f5.js"><link rel="prefetch" href="/yx-docs/assets/js/48.8acdad8d.js"><link rel="prefetch" href="/yx-docs/assets/js/49.aa4d5576.js"><link rel="prefetch" href="/yx-docs/assets/js/5.29239ed8.js"><link rel="prefetch" href="/yx-docs/assets/js/50.c1787f29.js"><link rel="prefetch" href="/yx-docs/assets/js/51.937bb7f3.js"><link rel="prefetch" href="/yx-docs/assets/js/52.dd17becb.js"><link rel="prefetch" href="/yx-docs/assets/js/6.52d05a44.js"><link rel="prefetch" href="/yx-docs/assets/js/7.e52f16a3.js"><link rel="prefetch" href="/yx-docs/assets/js/8.887870a8.js"><link rel="prefetch" href="/yx-docs/assets/js/9.3c3db4fc.js">
    <link rel="stylesheet" href="/yx-docs/assets/css/0.styles.f26e5750.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yx-docs/" class="home-link router-link-active"><img src="/yx-docs/logo.png" alt="前端小记" class="logo"> <span class="site-name can-hide">前端小记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/harryYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/harryYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/js基础/01_js类型.html" class="sidebar-link">js基础类型</a></li><li><a href="/yx-docs/js基础/02_dom操作.html" class="sidebar-link">DOM操作</a></li><li><a href="/yx-docs/js基础/03_原型原型链.html" class="sidebar-link">原型 prototype</a></li><li><a href="/yx-docs/js基础/04_作用域作用域链.html" class="sidebar-link">作用域 &amp; 作用域链</a></li><li><a href="/yx-docs/js基础/05_闭包.html" class="sidebar-link">闭包 closure</a></li><li><a href="/yx-docs/js基础/06_继承.html" class="sidebar-link">继承</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/css基础/01_选择器.html" class="sidebar-link">css选择器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>博客文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/articles/window.name.html" class="sidebar-link">window.name</a></li><li><a href="/yx-docs/articles/图片盗链.html" class="sidebar-link">图片盗链</a></li><li><a href="/yx-docs/questions/跨域.html" class="sidebar-link">何为跨域？</a></li><li><a href="/yx-docs/questions/http协议.html" class="sidebar-link">HTTP协议</a></li><li><a href="/yx-docs/questions/https介绍.html" class="sidebar-link">HTTPS介绍</a></li><li><a href="/yx-docs/questions/JS异步编程.html" class="sidebar-link">异步编程</a></li><li><a href="/yx-docs/questions/Event Loop是什么.html" class="active sidebar-link">EVENT LOOP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yx-docs/questions/Event Loop是什么.html#js是单线程的" class="sidebar-link">JS是单线程的</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/Event Loop是什么.html#web-worker-html5新特性" class="sidebar-link">Web Worker(html5新特性)</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/Event Loop是什么.html#service-worker" class="sidebar-link">Service Worker</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/Event Loop是什么.html#event-loop-2" class="sidebar-link">Event Loop</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/Event Loop是什么.html#node" class="sidebar-link">Node</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/Event Loop是什么.html#宏任务和微任务" class="sidebar-link">宏任务和微任务</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/Event Loop是什么.html#宏任务" class="sidebar-link">宏任务</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/Event Loop是什么.html#微任务" class="sidebar-link">微任务</a></li></ul></li><li><a href="/yx-docs/questions/输入URL回车后的过程.html" class="sidebar-link">浏览器输入 URL 回车之后发生了什么</a></li><li><a href="/yx-docs/questions/onload.html" class="sidebar-link">window.onload() &amp; document.ready() 事件先后顺序</a></li><li><a href="/yx-docs/questions/会话技术.html" class="sidebar-link">会话技术(Cookie和Session)</a></li><li><a href="/yx-docs/questions/XSS CSRF 点击劫持攻击.html" class="sidebar-link">1. XSS攻击</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/vue/vue技巧大全.html" class="sidebar-link">VUE技巧大全</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="event-loop"><a href="#event-loop" class="header-anchor">#</a> EVENT LOOP</h1> <h2 id="js是单线程的"><a href="#js是单线程的" class="header-anchor">#</a> JS是单线程的</h2> <p>作为浏览器的脚本语言,JS的主要用途就是操作DOM,以及与用户交互.这就决定了它只能是单线程的.否则会带来很复杂的同步问题.比如JS同时有两个线程,一个线程要在某个DOM节点上添加内容,而另一个线程要删除这个DOM节点,那么浏览器以哪个为准呢.因此JS必须是单线程的,它在同一时间只能做一件事.</p> <h2 id="web-worker-html5新特性"><a href="#web-worker-html5新特性" class="header-anchor">#</a> Web Worker(html5新特性)</h2> <p>Web Worker为JS创建多线程环境,允许主线程创建Worker线程,将一些任务分配给后者运行.在主线程运行的同时,Worker线程在后台运行,互不干扰,等到Worker线程完成运行,再把结果返回给主线程.但是Worker线程一旦新建成功,就会始终运行(不会被主线程的活动打断),会带来资源上的巨大消耗,因此当Worker对任务计算结束,就应该关闭.</p> <ul><li>同源限制: 分配给Worker线程的脚本文件,必须与主线程脚本文件同源</li> <li>文件限制: worker线程不能读取本地文件,只能执行同源脚本</li> <li>DOM限制: worker线程无法操作DOM</li> <li>通信限制: 主线程和worker线程不在同一个执行上下文,不能直接通信,需要通过消息完成</li> <li>脚本限制: Worker线程不能执行alert和confirm,但是可以调用XMLHttpRequest</li></ul> <h2 id="service-worker"><a href="#service-worker" class="header-anchor">#</a> Service Worker</h2> <p>Service Worker基于Web Worker,并在Web Worker上添加了离线缓存能力,它是一个服务器与浏览器的中间人(代理服务器)的角色,如果网站注册了Service Worker,那么就可以拦截当前网站的所有请求,进行管理(开发者自己编程判断)是否使用缓存或者发起请求.
Promises是一种非常适用于异步操作的机制,一个操作依赖于另一个操作的成功执行.这是Service Worker的核心工作机制.</p> <h2 id="event-loop-2"><a href="#event-loop-2" class="header-anchor">#</a> Event Loop</h2> <p>Event Loop 是一个很重要的概念，指的是计算机系统的一种运行机制。
JavaScript语言就采用这种机制，来解决单线程运行带来的一些问题。</p> <h3 id="浏览器"><a href="#浏览器" class="header-anchor">#</a> 浏览器</h3> <p>JS是单线程的,它在同一时间只能做一件事,那么这就意味着:前一个任务结束才能执行后一个任务.如果前一个任务(比如I/O、AJAX、回调函数)耗时很久,那么下一个任务就必须等待.如果因为计算量比较大,占用的CPU比较多(复杂的逻辑或者DOM渲染),还可以理解,但是如果只是简单的I/O那么我们就要考虑为什么不把这样的任务挂起,等到I/O操作完毕再执行呢.因此所有的任务又分为:同步任务和异步任务.</p> <ul><li>同步任务(synchronous):在主线程上排队执行的任务,只有前一个执行完毕,才会执行下一个任务</li> <li>异步任务(asynchronous):不进入主线程,进入任务队列(task queue)的任务,只有任务队列通知主线程某个任务可以执行了,该任务才会进入主线程执行.</li> <li>任务队列(task queue):一个事件队列,先进先出的数据结构,当异步任务完成,就会在队列中添加一个事件,表示相关的异步任务可以进入执行栈.排在前面的事件优先被主线程读取,读取的过程是自动的,当执行栈清空,任务队列的上的第一位事件就会自动进入主线程.主线程读取任务队列,其实就是读取里面的事件.
<ul><li>I/O任务完成,在任务队列中添加一个事件</li> <li>自定义事件(鼠标事件、ajax等)的回调函数,当触发交互动作,回调函数在任务队列中添加一个事件</li> <li>定时器(setTimeout/setInterval):向任务队列尾部添加定时事件,主线程检查执行时间,到达时间后,事件进入主线程.setTimeout(callback,time)在time毫秒后执行callback,指定任务在主线程最早可得的空闲时间执行,只执行一次,当time为0时表示当前执行栈清空立即执行callback.setInterval(callback,time)在time毫秒后执行callback,重复执行多次.html5规定setTimeout的time不得低于4毫秒,老版本浏览器规定不得低于10毫秒,而对于dom操作通常是16毫秒执行一次(requestAnimationFrmae &gt; setTimeout).</li></ul></li></ul> <p>执行栈中的同步任务总是在任务队列中的异步任务前执行.</p> <h2 id="node"><a href="#node" class="header-anchor">#</a> Node</h2> <img src="/yx-docs/imgs/node_event_loop.jpg" alt="foo"> <blockquote><ul><li>V8引起解析JS脚本</li> <li>解析后的代码调用Node API</li> <li>libuv库负责Node API的执行,它将不同的任务分配给不同的线程,形成Event Loop,以异步的方式将任务的执行结果返回给V8引擎</li> <li>V8引擎将结果返回给用户</li></ul></blockquote> <p>Node中Event Loop分为6个阶段</p> <ul><li>timers:执行setTimeout和setInterval中到期的callback</li> <li>pending callback: 上一轮循环中少数的callback会在这一阶段执行
idle,prepare:仅在内部使用</li> <li>poll:最重要的阶段,执行pending callback,在适当的情况下会阻塞在这个阶段</li> <li>check: 执行setImmediate的callback</li> <li>close callback: 执行close事件的callback</li> <li>process.nextTick:在当前执行栈尾部,下一次Event Loop之前触发回调函数,它指定的任务总是发生在所有异步任务之前(process.nextTick &gt; Promise)</li> <li>setImmediate:在当前任务队列尾部添加事件,指定的任务总是在下一次Event Loop时执行.(setImmediate &gt; setTimeout)</li></ul> <p>多个process.nextTick总是在当前执行栈一次执行完,多个setImmediate可能需要多次loop才能执行完成.</p> <p>Event Loop</p> <blockquote><ul><li>所有的同步任务都在主线程中执行,形成一个执行栈(当函数开始执行,形成一个执行上下文,推入执行栈)</li> <li>主线程之外有一个“任务队列”,只要异步任务有了运行结果,就在“任务队列”中放置一个事件</li> <li>一旦执行栈中的所有同步任务执行完毕,系统就会读取“任务队列”,看看有哪些事件,那么对应的异步任务,结束等待状态,进入执行栈,开始执行</li> <li>主线程不断重复以上三个步骤</li></ul></blockquote> <p>以上当主线程空了就去读取“任务队列”的事件这个循环的运行机制,就是<b>Event Loop</b>.</p> <h2 id="宏任务和微任务"><a href="#宏任务和微任务" class="header-anchor">#</a> 宏任务和微任务</h2> <img src="/yx-docs/imgs/event_loop1.jpg" alt="foo"> <ol><li>执行全局JS,全局JS作为全局任务,属于一个宏任务,其中的同步任务推入执行栈,异步任务中的宏任务进入任务队列,微任务进入微任务队列</li> <li>执行栈清空,执行微任务队列的微任务</li> <li>微任务队列清空,读取任务队列的宏任务到执行栈中</li> <li>循环执行步骤2、3</li></ol> <h2 id="宏任务"><a href="#宏任务" class="header-anchor">#</a> 宏任务</h2> <p>一般消息队列中的任务被称为宏任务,它是由浏览器或者Node环境实现的方法,在全局的JS也可以看作是一个宏任务.</p> <ul><li>Script(整体代码)</li> <li>setTimeout/setInterval(定时任务)</li> <li>I/O</li> <li>UI交互事件</li> <li>postMessage</li> <li>MessageChannel</li> <li>setImmidate(Node)</li></ul> <h2 id="微任务"><a href="#微任务" class="header-anchor">#</a> 微任务</h2> <p>由于消息队列中粗时间颗粒度的任务已经不能胜任部分领域的需求,所以微任务应运而生(ES6,ES3之前JS本身没有异步请求能力,不存在微任务,ES5之后引入Promise,JS不需要浏览器也可以发起异步任务),微任务可以在时效性和效率之间做个有效的权衡.每个宏任务都包含一个微任务队列.在当前宏任务的JS快要执行完成时(微任务检查点,JS引擎准备退出全局执行上下文清空执行栈),JS引擎会检查全局执行上下文中的微任务队列,按照顺序执行微任务.如果在执行微任务的过程中产生新的微任务,那么将会将该微任务加入当前微任务队列中,V8引擎会一直循环执行微任务队列中的任务,直到队列为空时才结束(新的微任务不会推迟).
由JS引擎提供的方法就属于微任务.</p> <ul><li>Promise</li> <li>MutationObserver</li> <li>process.nextTick(Node)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span> <span class="token comment">// 全局JS,作为宏任务加入到执行栈</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 定时器任务,推入任务队列(宏任务)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 定时器任务,推入任务队列(宏任务)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 微任务</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span> <span class="token comment">// 全局JS,作为宏任务加入到执行栈</span>
</code></pre></div><p>那么这个执行结果为</p> <blockquote><p>VM123:1 start<br>
VM123:21 end<br>
VM123:18 promise3<br>
undefined<br>
VM123:4 timer1<br>
VM123:6 promise1<br>
VM123:11 timer2<br>
VM123:13 promise2</p></blockquote> <ul><li>log('start')作为全局JS,输出start</li> <li>setTimeout作为定时器任务,将回调函数加入任务队列</li> <li>setTimeout作为定时器任务,将回调函数加入任务队列</li> <li>Promise.then作为微任务,加入微任务队列</li> <li>log('end')作为全局JS,输出end</li> <li>执行栈清空,全局JS作为宏任务执行完毕,开始执行微任务队列,此时微任务队列中存在log('promise3')</li> <li>微任务队列清空,将任务队列事件推入执行栈,判断定时时间开始执行定时事件</li> <li>定时事件log('timer1'),同时Promise.then加入微任务队列,宏任务执行结束,执行微任务,输出promise1</li> <li>定时事件log('timer2'),同时Promise.then加入微任务队列,宏任务执行结束,执行微任务,输出promise2</li></ul> <p>作者：zjwgank在掘金
链接：https://juejin.cn/post/6942882400703610916</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yx-docs/questions/JS异步编程.html" class="prev">
        异步编程
      </a></span> <span class="next"><a href="/yx-docs/questions/输入URL回车后的过程.html">
        浏览器输入 URL 回车之后发生了什么
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yx-docs/assets/js/app.5a460998.js" defer></script><script src="/yx-docs/assets/js/2.beed6d36.js" defer></script><script src="/yx-docs/assets/js/38.ba52d01e.js" defer></script>
  </body>
</html>
