<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>何为跨域？ | 前端小记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="/yx-docs/favicon.ico">
    <meta name="description" content="yaoxin的笔记文档">
    
    <link rel="preload" href="/yx-docs/assets/css/0.styles.9a4ca8c0.css" as="style"><link rel="preload" href="/yx-docs/assets/js/app.1f8db363.js" as="script"><link rel="preload" href="/yx-docs/assets/js/2.9b395b71.js" as="script"><link rel="preload" href="/yx-docs/assets/js/26.cd67ef83.js" as="script"><link rel="prefetch" href="/yx-docs/assets/js/10.70e9c633.js"><link rel="prefetch" href="/yx-docs/assets/js/11.be0003c0.js"><link rel="prefetch" href="/yx-docs/assets/js/12.6b4f26fb.js"><link rel="prefetch" href="/yx-docs/assets/js/13.e821978c.js"><link rel="prefetch" href="/yx-docs/assets/js/14.b5ab0c9f.js"><link rel="prefetch" href="/yx-docs/assets/js/15.b61d4926.js"><link rel="prefetch" href="/yx-docs/assets/js/16.0286b90f.js"><link rel="prefetch" href="/yx-docs/assets/js/17.ed316f65.js"><link rel="prefetch" href="/yx-docs/assets/js/18.dece7930.js"><link rel="prefetch" href="/yx-docs/assets/js/19.5329f526.js"><link rel="prefetch" href="/yx-docs/assets/js/20.6e2ad28a.js"><link rel="prefetch" href="/yx-docs/assets/js/21.ff4ace06.js"><link rel="prefetch" href="/yx-docs/assets/js/22.798982e4.js"><link rel="prefetch" href="/yx-docs/assets/js/23.5a0b9d84.js"><link rel="prefetch" href="/yx-docs/assets/js/24.50939df2.js"><link rel="prefetch" href="/yx-docs/assets/js/25.a1c23ef2.js"><link rel="prefetch" href="/yx-docs/assets/js/27.800a4094.js"><link rel="prefetch" href="/yx-docs/assets/js/28.f0b8fd5f.js"><link rel="prefetch" href="/yx-docs/assets/js/29.ba0b17dd.js"><link rel="prefetch" href="/yx-docs/assets/js/3.a3d1667a.js"><link rel="prefetch" href="/yx-docs/assets/js/4.04feb3f1.js"><link rel="prefetch" href="/yx-docs/assets/js/5.f27f6877.js"><link rel="prefetch" href="/yx-docs/assets/js/6.f8bc49fe.js"><link rel="prefetch" href="/yx-docs/assets/js/7.92386821.js"><link rel="prefetch" href="/yx-docs/assets/js/8.d6d6885e.js"><link rel="prefetch" href="/yx-docs/assets/js/9.c718979f.js">
    <link rel="stylesheet" href="/yx-docs/assets/css/0.styles.9a4ca8c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yx-docs/" class="home-link router-link-active"><img src="/yx-docs/logo.png" alt="前端小记" class="logo"> <span class="site-name can-hide">前端小记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/harryYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/harryYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/js基础/01_js类型.html" class="sidebar-link">js基础类型</a></li><li><a href="/yx-docs/js基础/02_dom操作.html" class="sidebar-link">DOM操作</a></li><li><a href="/yx-docs/js基础/03_原型原型链.html" class="sidebar-link">原型 prototype</a></li><li><a href="/yx-docs/js基础/04_作用域作用域链.html" class="sidebar-link">作用域</a></li><li><a href="/yx-docs/js基础/05_闭包.html" class="sidebar-link">闭包 closure</a></li><li><a href="/yx-docs/js基础/06_继承.html" class="sidebar-link">继承</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/css基础/01_选择器.html" class="sidebar-link">css选择器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>博客文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/articles/window.name.html" class="sidebar-link">window.name</a></li><li><a href="/yx-docs/questions/跨域.html" class="active sidebar-link">何为跨域？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yx-docs/questions/跨域.html#何为跨域" class="sidebar-link">何为跨域？</a></li><li class="sidebar-sub-header"><a href="/yx-docs/questions/跨域.html#如何去解决" class="sidebar-link">如何去解决？</a></li></ul></li><li><a href="/yx-docs/questions/http协议.html" class="sidebar-link">HTTP协议</a></li><li><a href="/yx-docs/questions/https介绍.html" class="sidebar-link">HTTPS介绍</a></li><li><a href="/yx-docs/questions/JS异步编程.html" class="sidebar-link">一、异步编程简介</a></li><li><a href="/yx-docs/questions/Event Loop是什么.html" class="sidebar-link">JS是单线程的</a></li><li><a href="/yx-docs/questions/输入URL回车后的过程.html" class="sidebar-link">浏览器输入 URL 回车之后发生了什么</a></li><li><a href="/yx-docs/questions/onload.html" class="sidebar-link">window.onload() &amp; document.ready() 事件先后顺序</a></li><li><a href="/yx-docs/questions/会话技术.html" class="sidebar-link">会话技术(Cookie和Session)</a></li><li><a href="/yx-docs/questions/XSS CSRF 点击劫持攻击.html" class="sidebar-link">1. XSS攻击</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yx-docs/vue/vue技巧大全.html" class="sidebar-link">VUE技巧大全</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="何为跨域"><a href="#何为跨域" class="header-anchor">#</a> 何为跨域？</h2> <p>首先，我们得先理解一下何为跨域？所谓跨域，即网站的协议名 protocol（例如 http 😕/） 、域名 host （例如：www.example.com）、端口号 port (例如 80 ，默认端口可以省略) 这三个中的任意一个不同，网站之间的数据传输或者请求就属于跨域请求了。</p> <p>这是由于浏览器的同源策略，为了防范跨站脚本的攻击，禁止客户端脚本对不同域的服务进行跨站调用，但是跨域并非浏览器限制了发起跨站请求，而是跨站请求可以正常发起，但返回结果被浏览器拦截了。有些浏览器不允许从HTTPS协议的域 跨域访问 HTTP协议，比如Chrome和Firefox，这些浏览器在请求还未发出的时候就会拦截请求，这是一个特例。如果是非同源，共有三种行为受到限制：（1）cookie、LocalStorage 和 IndexDB 无法读取；（2）DOM 无法获得；（3）AJAX请求不能发送。</p> <p>【这里再解释一下同源（具体定义可以查看 MDN），如果两个页面的协议，端口（如果有指定）和域名都相同，则两个页面具有相同的源。IE 有例外，一是授信范围：两个相互之间高度互信的域名，不遵守同源策略的限制；二是端口：IE 未将端口号加入到同源策略的组成成分中。更多有关源的介绍可以查看 MDN ：https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy】</p> <h2 id="如何去解决"><a href="#如何去解决" class="header-anchor">#</a> 如何去解决？</h2> <p>接着，既然我们知道了何为跨域，跨越有时候在实际的开发中有时候又无法避免，下面介绍几种常见的跨域方法：</p> <h3 id="_1、利用-jsonp-实现跨域"><a href="#_1、利用-jsonp-实现跨域" class="header-anchor">#</a> 1、利用 JSONP 实现跨域</h3> <p>JSONP （JSON with Padding）是 JSON 的一种“使用模式”。利用 JSON 实现跨域的原理是：HTML 的 script 标签是不受同源策略的限制的，可以通过 script 标签加载并执行其他的域的 js 文件的。</p> <p>例如通过 jQery 封装的方法可以很方便地进行 JSONP 的操作：</p> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  url<span class="token operator">:</span> <span class="token string">'http://jjjjjjjj.com/data'</span><span class="token punctuation">,</span>
  <span class="token comment">// 需要提交给服务端的数据:</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'燕子'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 指定数据类型:</span>
  dataType<span class="token operator">:</span> <span class="token string">'jsonp'</span><span class="token punctuation">,</span>
  timeout<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>project<span class="token punctuation">.</span>html<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'数据获取失败！'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//使用$.getJSON</span>
$<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'http://jjjjjjjj.com/data?callback=?,function(data)'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//处理获得的json数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>总结：
JSONP 的兼容性好，在更古老的浏览器都可以运行，不需要 XMLHTTPRequest 或 ActiveX 的支持，并且在请求完毕后可以通过调用 callback 的方式回传结果；
然而缺点是，它只支持 GET 请求 而不支持 POST 等其他类型的 HTTP 请求；还有 只支持跨域 HTTP 请求这种情况，不能解决不同域的两个页面的之间 JavaScript 调用的问题；</p> <h3 id="_2、利用-cors-实现跨域"><a href="#_2、利用-cors-实现跨域" class="header-anchor">#</a> 2、利用 CORS 实现跨域</h3> <p>CORS （Cross-Origin Resource Sharing）跨域资源共享，定义了必须在访问跨域资源时，浏览器与服务器应该如何沟通。CORS 背后的思想是使用自定义的 HTTP 头部，让服务器能声明哪些来源可以通过浏览器访问该服务器上的资源，从而决定请求或响应是应该成功还是失败，CORS 本身并非绝对的安全，可利用 OAuth2 加强保障。（更多关于 CORS 的详解可以查看 阮一峰老师的一篇文章：跨域资源共享 CORS 详解）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin: *&quot;</span><span class="token punctuation">)</span>       <span class="token comment">//“*”号表示允许任何域向我们的服务端提交请求</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin: http://jjjjj.jd.com&quot;</span><span class="token punctuation">)</span>      <span class="token comment">//也可以设置指定的域名</span>
</code></pre></div><p>与 JSONP 相比，CORS 更为先进、方便：
CORS 支持所有类型的 HTTP 请求；
使用CORS，开发者可以使用普通的XMLHttpRequest发起请求和获得数据，比起JSONP有更好的错误处理；
绝大多数现代浏览器都已经支持了CORS；</p> <h3 id="_3、window-name-iframe"><a href="#_3、window-name-iframe" class="header-anchor">#</a> 3、window.name + iframe</h3> <p>当window 的 loaction 变化时，页面重新加载，它的 name 属性可以依然保持不变。每个页面的对 window.name 都有读写权限，window.name 是持久存在一个窗口载入过所有页面中的。 我们可以在页面 A中用iframe加载其他域的页面B，而页面B中用JavaScript把需要传递的数据赋值给window.name，iframe加载完成之后（iframe.onload），页面A修改iframe的地址，将其变成同域的一个地址，然后就可以读出iframe的window.name的值了（因为A中的window.name和iframe中的window.name互相独立的，所以不能直接在A中获取window.name，而要通过iframe获取其window.name）。这个方式非常适合单向的数据请求，而且协议简单、安全。不会像JSONP那样不做限制地执行外部脚本。</p> <h3 id="_4、document-domain-跨域-只适用于不同子域的框架间的交互"><a href="#_4、document-domain-跨域-只适用于不同子域的框架间的交互" class="header-anchor">#</a> 4、document.domain 跨域（只适用于不同子域的框架间的交互）</h3> <p>利用document.domain 实现跨域：
前提条件：这两个域名必须属于同一个基础域名!而且所用的协议，端口都要一致，否则无法利用document.domain进行跨域.</p> <p>同源策略不能用 ajax 方法去请求不同源的文档，还有一个限制就是浏览器不同域的框架之间不能进行 JS 的交互操作的，不同的框架可以获取 window 对象，但无法获取相应的属性和方法。</p> <p>这个时候，我们可以通过把两个页面的 document.domain 都设成相同的域名就可以，不过 window.domain 的设置也是有限制的，只能把 window.domain 设置成自身或更高一级的父域，且主域必须相同</p> <h3 id="_5、html5-的-postmessage-方法"><a href="#_5、html5-的-postmessage-方法" class="header-anchor">#</a> 5、HTML5 的 postMessage 方法</h3> <p>高级浏览器Internet Explorer 8+, chrome，Firefox , Opera 和 Safari 都将支持这个功能。这个功能主要包括接受信息的&quot;message&quot;事件和发送消息的&quot;postMessage&quot;方法。</p> <p>window.postMessage() 方法被调用时，会在所有页面脚本执行完毕之后（例如：在该方法之后设置的事件、之前设置的timeout 事件）向目标窗口派发一个 MessageEvent 消息。 该 MessageEvent 消息有四个属性需要注意： message 属性表示该 message 的类型； data 属性为 window.postMessage 的第一个参数；origin 属性表示调用 window.postMessage() 方法时调用页面的当前状态； source 属性记录调用 window.postMessage() 方法的窗口信息。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//弹出一个新窗口</span>
<span class="token keyword">var</span> domain <span class="token operator">=</span> <span class="token string">'http://scriptandstyle.com'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myPopup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>domain 
            <span class="token operator">+</span> <span class="token string">'/windowPostMessageListener.html'</span><span class="token punctuation">,</span><span class="token string">'myWindow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//周期性的发送消息</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">'Hello!  The time is: '</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'blog.local:  sending message:  '</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//send the message and target URI</span>
	myPopup<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> domain<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//监听消息反馈</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>origin <span class="token operator">!==</span> <span class="token string">'http://scriptandstyle.com'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'received response:  '</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>作者：Yanzery
链接：https://www.jianshu.com/p/79daa0d45aac
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yx-docs/articles/window.name.html" class="prev">
        window.name
      </a></span> <span class="next"><a href="/yx-docs/questions/http协议.html">
        HTTP协议
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yx-docs/assets/js/app.1f8db363.js" defer></script><script src="/yx-docs/assets/js/2.9b395b71.js" defer></script><script src="/yx-docs/assets/js/26.cd67ef83.js" defer></script>
  </body>
</html>
